<html>
<head></head>
<body>
	<div>
		<canvas id="canvas" tabindex="1" width="800" height="100"></canvas>
	</div>
	<script src="axe.js"></script>
	<script src="point.js"></script>
	<script src="rectangle.js"></script>
	<script src="canvas.js"></script>
	<script src="actor.js"></script>
	<script src="versioned-queue.js"></script>
	<script src="game.js"></script>
	<script src="key-codes.js"></script>
	<script src="appearance.js"></script>
	<script src="validate.js"></script>
	<script>


	var Stopped = { 
		mouseDown: function(context, value) {
			value.selected = !value.selected;
		},
		keyPress: function(context, value, keyCode){
			if(value.selected && keyCode === KeyCodes.LEFT_ARROW) {
				value.x -= 50
				context.become(Moving)
			}
		}
	}

	var Moving = Object.create(Stopped)
	Moving.update = function(context, value, dt) {
		value.x += 100 * dt 
	};
	Moving.collide = function(context){
		context.become(Stopped)
	}

	var Square = {
		value: {
			x: 0, 
			selected: false
		},
		behaviour: Moving,
		render: function(value, bound, canvas) {
			canvas.drawRectangle(bound, value.selected ? '#0ED600' : '#8ED6FF');
		},
		bound: rectangular({y:0, width: 100, height: 100})
	};

	var LittleSquare = {
		value: {x: 400},
		behaviour: {
			update: Moving.update,
			hide: function(context) {
				context.destroy();
			}
		},
		render: function(value, bound, canvas) {
			canvas.drawRectangle(bound);
		},
		bound: rectangular({y:50, width: 10, height: 10})
	}

	var Wall = {
		value: {
			touching: false, 
		},
		behaviour: {
			collide: function(context, value) {
				value.touching = true;
				context.createActor(LittleSquare)
			},
			uncollide: function(context, value) {
				value.touching = false;
			}
		},
		render: function(value, bound, canvas) {
			canvas.drawRectangle(bound, value.touching ? '#FF2020' : null);
		},
		bound: rectangular(new Rectangle(400, 0, 10, 180))
	};

	var canvas1 = new Canvas('canvas');
	var game = new Game(canvas1);
	game.createActor(Square);
	game.createActor(Wall);
	game.run();
	//entity: actor(id + state + behaviour) + bounding + visual rendering 
	</script>
</body>
</html>
